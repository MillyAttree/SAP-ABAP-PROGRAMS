*&---------------------------------------------------------------------*
*& Report  Y90_MAT_TO_MAT_TRANSFER
*&
*&---------------------------------------------------------------------*
*&
*&
*&---------------------------------------------------------------------*
REPORT Y90_MAT_TO_MAT_TRANSFER.

TABLES : MSEG, MKPF, MAKT.

TYPE-POOLS: SLIS.

DATA: IT_FIELDCAT            TYPE SLIS_T_FIELDCAT_ALV.
DATA: WA_FIELDCAT            LIKE LINE OF IT_FIELDCAT.
DATA: T_LIST_TOP_OF_PAGE     TYPE SLIS_T_LISTHEADER.
DATA: IT_EVENTS              TYPE SLIS_T_EVENT WITH HEADER LINE.
DATA: G_SAVE                 TYPE C VALUE 'A'.
DATA: GT_SORT                TYPE SLIS_T_SORTINFO_ALV.
DATA: GX_SAVE                TYPE C VALUE 'A'.
DATA: GX_VARIANT             TYPE DISVARIANT.
DATA: G_VARIANT              TYPE DISVARIANT.
DATA: GS_LAYOUT              TYPE SLIS_LAYOUT_ALV.
DATA: T_FORMNAME_TOP_OF_PAGE TYPE SLIS_FORMNAME VALUE 'TOP_OF_PAGE'.
DATA: T_I_EVENT              TYPE SLIS_ALV_EVENT.


TYPES :BEGIN OF TY_MSEG,
       MBLNR LIKE MSEG-MBLNR,
       MJAHR LIKE MSEG-MJAHR,
       ZEILE LIKE MSEG-ZEILE,
       BWART LIKE MSEG-BWART,
       WERKS LIKE MSEG-WERKS,
       MENGE LIKE MSEG-MENGE,
       MEINS LIKE MSEG-MEINS,
       LGORT LIKE MSEG-LGORT,
       CHARG LIKE MSEG-CHARG,
       MATNR LIKE MSEG-MATNR,
       SOBKZ LIKE MSEG-SOBKZ, " SPECIAL STOCK INDICATOR
       UMMAT LIKE MSEG-UMMAT, " RECIEVE MAT
       UMWRK LIKE MSEG-UMWRK, " RECIEVE PLANT
       UMLGO LIKE MSEG-UMLGO, " RECIEVE ST. LOC
       UMCHA LIKE MSEG-UMCHA, " RECIEVE BATCH
       END OF TY_MSEG.

DATA: IT_MSEG TYPE STANDARD TABLE OF TY_MSEG,
      WA_MSEG TYPE TY_MSEG.


TYPES : BEGIN OF TY_MKPF,
        MBLNR LIKE MSEG-MBLNR,
        MJAHR LIKE MSEG-MJAHR,
        BLDAT LIKE MKPF-BLDAT,
        BLART LIKE MKPF-BLART,
        END OF TY_MKPF.

DATA : IT_MKPF TYPE STANDARD TABLE OF TY_MKPF,
       WA_MKPF TYPE TY_MKPF.

TYPES : BEGIN OF TY_FIN,
          MBLNR LIKE MSEG-MBLNR,
          BWART LIKE MSEG-BWART,
          WERKS LIKE MSEG-WERKS,
          MEINS LIKE MSEG-MEINS,
          MENGE LIKE MSEG-MENGE,
          BLDAT LIKE MKPF-BLDAT,
          MATNR LIKE MARA-MATNR,
          LGORT LIKE MSEG-LGORT,
          CHARG LIKE MSEG-CHARG,
          UMMAT LIKE MSEG-UMMAT,
          UMWRK LIKE MSEG-UMWRK,
          UMLGO LIKE MSEG-UMLGO,
          UMCHA LIKE MSEG-UMCHA,
          MAKTX LIKE MAKT-MAKTX,
          MAKTG LIKE MAKT-MAKTX,
        END OF TY_FIN.

DATA : IT_FIN TYPE STANDARD TABLE OF TY_FIN,
       WA_FIN TYPE TY_FIN.

DATA : MAKTX LIKE MAKT-MAKTX,
       MAKTG LIKE MAKT-MAKTX.

SELECTION-SCREEN BEGIN OF BLOCK B1 WITH FRAME TITLE TEXT-T01.
  SELECT-OPTIONS : S_WERKS FOR MSEG-WERKS DEFAULT '1000' OBLIGATORY.
  SELECT-OPTIONS : S_MATNR FOR MSEG-MATNR.
  SELECT-OPTIONS : S_BLDAT FOR MKPF-BLDAT OBLIGATORY.
SELECTION-SCREEN END OF BLOCK B1.

START-OF-SELECTION .

  PERFORM DATA.
  PERFORM DISP.
  PERFORM ALV.


FORM DATA.

   SELECT MBLNR
          MJAHR
          BLDAT
          BLART
   FROM MKPF INTO TABLE IT_MKPF WHERE  BLDAT IN S_BLDAT.


   IF NOT IT_MKPF IS INITIAL.
   SELECT MBLNR
          MJAHR
          ZEILE
          BWART
          WERKS
          MENGE
          MEINS
          LGORT
          CHARG
          MATNR
          SOBKZ
          UMMAT
          UMWRK
          UMLGO
          UMCHA
       FROM MSEG INTO TABLE IT_MSEG FOR ALL ENTRIES IN IT_MKPF WHERE MBLNR EQ IT_MKPF-MBLNR
                                                               AND   MJAHR EQ IT_MKPF-MJAHR
                                                               AND   MATNR IN  S_MATNR
                                                               AND   WERKS IN  S_WERKS
                                                               AND   SOBKZ EQ  'E'
                                                               AND ( BWART EQ  '411' OR
                                                                     BWART EQ  '412' ).

   ENDIF.

  LOOP AT IT_MSEG INTO WA_MSEG.
   WA_FIN-MBLNR = WA_MSEG-MBLNR.
   WA_FIN-WERKS = WA_MSEG-WERKS.
   WA_FIN-MEINS = WA_MSEG-MEINS.
   WA_FIN-MATNR = WA_MSEG-MATNR.
   WA_FIN-MENGE = WA_MSEG-MENGE.
   WA_FIN-BWART = WA_MSEG-BWART.
   WA_FIN-LGORT = WA_MSEG-LGORT.
   WA_FIN-CHARG = WA_MSEG-CHARG.
   WA_FIN-UMMAT = WA_MSEG-UMMAT.
   WA_FIN-UMWRK = WA_MSEG-UMWRK.
   WA_FIN-UMLGO = WA_MSEG-UMLGO.
   WA_FIN-UMCHA = WA_MSEG-UMCHA.

   CLEAR MAKT-MAKTX.
   SELECT SINGLE MAKTX FROM MAKT INTO (MAKT-MAKTX) WHERE MATNR = WA_MSEG-MATNR.
   IF SY-SUBRC EQ 0.
   WA_FIN-MAKTX = MAKT-MAKTX.
   ENDIF.

   CLEAR MAKT-MAKTG.
   SELECT SINGLE MAKTX FROM MAKT INTO (MAKT-MAKTG) WHERE MATNR = WA_MSEG-UMMAT.
   IF SY-SUBRC EQ 0.
   WA_FIN-MAKTG = MAKT-MAKTG.
   ENDIF.

   CLEAR WA_MKPF.
   READ TABLE IT_MKPF INTO WA_MKPF WITH KEY MBLNR = WA_MSEG-MBLNR
                                            MJAHR = WA_MSEG-MJAHR.
   IF SY-SUBRC EQ 0.
   WA_FIN-BLDAT = WA_MKPF-BLDAT.
   ENDIF.

   APPEND WA_FIN TO IT_FIN.
   CLEAR WA_FIN.
   ENDLOOP.
ENDFORM.


FORM DISP.
   DATA: COUNTER TYPE I.

  COUNTER = COUNTER + 1.
  WA_FIELDCAT-COL_POS    = COUNTER.
  WA_FIELDCAT-FIELDNAME  = 'MBLNR'.
  WA_FIELDCAT-TABNAME    = 'IT_FIN'.
  WA_FIELDCAT-SELTEXT_L  = 'MAT DOC'.
  WA_FIELDCAT-NO_ZERO    = 'X'.
  WA_FIELDCAT-OUTPUTLEN  = 15.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  COUNTER = COUNTER + 1.
  WA_FIELDCAT-COL_POS    = COUNTER.
  WA_FIELDCAT-FIELDNAME  = 'MATNR'.
  WA_FIELDCAT-TABNAME    = 'IT_FIN'.
  WA_FIELDCAT-SELTEXT_L  = 'MATERIAL'.
  WA_FIELDCAT-NO_ZERO    = 'X'.
  WA_FIELDCAT-OUTPUTLEN  = 15.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  COUNTER = COUNTER + 1.
  WA_FIELDCAT-COL_POS    = COUNTER.
  WA_FIELDCAT-FIELDNAME  = 'MAKTX'.
  WA_FIELDCAT-TABNAME    = 'IT_FIN'.
  WA_FIELDCAT-SELTEXT_L  = 'MATERIAL DESC.'.
  WA_FIELDCAT-NO_ZERO    = 'X'.
  WA_FIELDCAT-OUTPUTLEN  = 30.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  COUNTER = COUNTER + 1.
  WA_FIELDCAT-COL_POS    = COUNTER.
  WA_FIELDCAT-FIELDNAME  = 'CHARG'.
  WA_FIELDCAT-TABNAME    = 'IT_FIN'.
  WA_FIELDCAT-SELTEXT_L  = 'BATCH'.
  WA_FIELDCAT-NO_ZERO    = 'X'.
  WA_FIELDCAT-OUTPUTLEN  = 15.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  COUNTER = COUNTER + 1.
  WA_FIELDCAT-COL_POS    = COUNTER.
  WA_FIELDCAT-FIELDNAME  = 'LGORT'.
  WA_FIELDCAT-TABNAME    = 'IT_FIN'.
  WA_FIELDCAT-SELTEXT_L  = 'ST. LOC'.
  WA_FIELDCAT-NO_ZERO    = 'X'.
  WA_FIELDCAT-OUTPUTLEN  = 5.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  COUNTER = COUNTER + 1.
  WA_FIELDCAT-COL_POS    = COUNTER.
  WA_FIELDCAT-FIELDNAME  = 'BLDAT'.
  WA_FIELDCAT-TABNAME    = 'IT_FIN'.
  WA_FIELDCAT-SELTEXT_L  = 'DOC DATE'.
  WA_FIELDCAT-NO_ZERO    = 'X'.
  WA_FIELDCAT-OUTPUTLEN  = 10.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  COUNTER = COUNTER + 1.
  WA_FIELDCAT-COL_POS    = COUNTER.
  WA_FIELDCAT-FIELDNAME  = 'MENGE'.
  WA_FIELDCAT-TABNAME    = 'IT_FIN'.
  WA_FIELDCAT-SELTEXT_L  = 'QTY'.
  WA_FIELDCAT-NO_ZERO    = 'X'.
  WA_FIELDCAT-OUTPUTLEN  = 10.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  COUNTER = COUNTER + 1.
  WA_FIELDCAT-COL_POS    = COUNTER.
  WA_FIELDCAT-FIELDNAME  = 'MEINS'.
  WA_FIELDCAT-TABNAME    = 'IT_FIN'.
  WA_FIELDCAT-SELTEXT_L  = 'UOM'.
  WA_FIELDCAT-NO_ZERO    = 'X'.
  WA_FIELDCAT-OUTPUTLEN  = 4.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  COUNTER = COUNTER + 1.
  WA_FIELDCAT-COL_POS    = COUNTER.
  WA_FIELDCAT-FIELDNAME  = 'BWART'.
  WA_FIELDCAT-TABNAME    = 'IT_FIN'.
  WA_FIELDCAT-SELTEXT_L  = 'MOV TYPE'.
  WA_FIELDCAT-NO_ZERO    = 'X'.
  WA_FIELDCAT-OUTPUTLEN  = 5.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.


  COUNTER = COUNTER + 1.
  WA_FIELDCAT-COL_POS    = COUNTER.
  WA_FIELDCAT-FIELDNAME  = 'UMMAT'.
  WA_FIELDCAT-TABNAME    = 'IT_FIN'.
  WA_FIELDCAT-SELTEXT_L  = 'RECIVE MAT'.
  WA_FIELDCAT-NO_ZERO    = 'X'.
  WA_FIELDCAT-OUTPUTLEN  = 20.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  COUNTER = COUNTER + 1.
  WA_FIELDCAT-COL_POS    = COUNTER.
  WA_FIELDCAT-FIELDNAME  = 'MAKTG'.
  WA_FIELDCAT-TABNAME    = 'IT_FIN'.
  WA_FIELDCAT-SELTEXT_L  = 'MAT DESC'.
  WA_FIELDCAT-NO_ZERO    = 'X'.
  WA_FIELDCAT-OUTPUTLEN  = 30.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  COUNTER = COUNTER + 1.
  WA_FIELDCAT-COL_POS    = COUNTER.
  WA_FIELDCAT-FIELDNAME  = 'UMCHA'.
  WA_FIELDCAT-TABNAME    = 'IT_FIN'.
  WA_FIELDCAT-SELTEXT_L  = 'REC BATCH'.
  WA_FIELDCAT-NO_ZERO    = 'X'.
  WA_FIELDCAT-OUTPUTLEN  = 10.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

  COUNTER = COUNTER + 1.
  WA_FIELDCAT-COL_POS    = COUNTER.
  WA_FIELDCAT-FIELDNAME  = 'UMLGO'.
  WA_FIELDCAT-TABNAME    = 'IT_FIN'.
  WA_FIELDCAT-SELTEXT_L  = 'REC ST LOC'.
  WA_FIELDCAT-NO_ZERO    = 'X'.
  WA_FIELDCAT-OUTPUTLEN  = 5.
  APPEND WA_FIELDCAT TO IT_FIELDCAT.
  CLEAR WA_FIELDCAT.

ENDFORM.

FORM ALV.
  GS_LAYOUT-ZEBRA                = 'X'.
  GS_LAYOUT-DETAIL_POPUP         = 'X'.
  GS_LAYOUT-DETAIL_INITIAL_LINES = 'X'.

  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
    EXPORTING
      IT_FIELDCAT        = IT_FIELDCAT
      IT_EVENTS          = IT_EVENTS[]
      I_CALLBACK_PROGRAM = SY-REPID
      IS_LAYOUT          = GS_LAYOUT
      IT_SORT            = GT_SORT[]
      I_SAVE             = G_SAVE
      IS_VARIANT         = GX_VARIANT
*      I_CALLBACK_PF_STATUS_SET   = 'ZSTANDARD'
*      I_CALLBACK_USER_COMMAND = 'USER_COMMAND'
    TABLES
      T_OUTTAB           = IT_FIN[].
  .
ENDFORM.

