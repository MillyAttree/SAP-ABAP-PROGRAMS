*&---------------------------------------------------------------------*
*& Report  Y37_THREETABLE_DATA
*&
*&---------------------------------------------------------------------*
*&
*&
*&---------------------------------------------------------------------*

REPORT  Y37_THREETABLE_DATA.

TABLES:MARA,
       MARC,
       MARD,EKPO,EBAN.


TYPES:BEGIN OF TY_MARA,
      MATNR TYPE MATNR,
      MTART TYPE MTART,
      END OF TY_MARA.
      TYPES:BEGIN OF TY_MARC,
      MATNR TYPE MATNR,
      WERKS TYPE WERKS_D,
      PSTAT TYPE PSTAT_D,
      END OF TY_MARC.
      TYPES:BEGIN OF TY_MARD,
      MATNR TYPE MATNR,
      WERKS TYPE WERKS_D,
      LGORT TYPE LGORT_D,
      END OF TY_MARD.


 TYPES:BEGIN OF TY_FIN,
      MATNR TYPE MATNR,
   MTART TYPE MTART,
      WERKS TYPE WERKS_D,
      LGORT TYPE LGORT_D,
*   WERKS TYPE WERKS_D,
      PSTAT TYPE PSTAT_D,
*      LGORT TYPE LGORT_D,
      END OF TY_FIN.


      DATA:IT_MARA TYPE STANDARD TABLE OF TY_MARA,
            IT_MARC TYPE STANDARD TABLE OF TY_MARC,
            IT_MARD TYPE STANDARD TABLE OF TY_MARD,
            IT_FIN TYPE STANDARD TABLE OF TY_FIN,
      WA_MARA TYPE TY_MARA,
       WA_MARC TYPE TY_MARC,
        WA_MARD TYPE TY_MARD,
         WA_FIN TYPE TY_FIN.

INITIALIZATION.

CLEAR:WA_MARA,WA_MARC,WA_MARD,WA_FIN.

REFRESH:IT_MARA,IT_MARC,IT_MARD,IT_FIN.



SELECTION-SCREEN:BEGIN OF BLOCK B1 WITH FRAME TITLE TEXT-001.

      SELECT-OPTIONS:S_MATNR FOR MARA-MATNR OBLIGATORY,
                     S_WERKS FOR MARC-WERKS,
                     S_LGORT FOR MARD-LGORT.

      SELECTION-SCREEN:END OF BLOCK B1.


AT SELECTION-SCREEN.



  START-OF-SELECTION.
  SELECT MATNR MTART FROM MARA INTO TABLE IT_MARA WHERE MATNR IN S_MATNR.

  IF SY-SUBRC = 0.
    SORT IT_MARA BY MATNR.
  ENDIF.

 IF NOT IT_MARA[] IS INITIAL.
 SELECT MATNR
        WERKS
        PSTAT FROM MARC INTO TABLE IT_MARC FOR ALL ENTRIES IN IT_MARA WHERE MATNR = IT_MARA-MATNR
   AND WERKS IN S_WERKS.


IF SY-SUBRC = 0.
SORT IT_MARC BY MATNR.
ENDIF.

 ENDIF.

IF NOT IT_MARC[] IS INITIAL.
 SELECT MATNR
        WERKS
        LGORT FROM MARD INTO TABLE IT_MARD[] FOR ALL ENTRIES IN IT_MARC   WHERE MATNR = IT_MARC-MATNR
   AND LGORT IN S_LGORT.


ENDIF.

 IF SY-SUBRC = 0.
  SORT  IT_MARD BY MATNR.
 ENDIF.


 END-OF-SELECTION.


 LOOP AT IT_MARA INTO WA_MARA.
WA_FIN-MATNR = WA_MARA-MATNR.
WA_FIN-MTART = WA_MARA-MTART.

CLEAR:WA_MARC.
READ TABLE IT_MARC INTO WA_MARC WITH KEY MATNR = WA_MARA-MATNR.
IF SY-SUBRC = 0.
WA_FIN-WERKS  = WA_MARC-WERKS.
ENDIF.

CLEAR:WA_MARD.
READ TABLE IT_MARD INTO WA_MARD WITH KEY MATNR = WA_MARA-MATNR.
IF SY-SUBRC = 0.
WA_FIN-LGORT  = WA_MARD-LGORT.
ENDIF.


   APPEND WA_FIN TO IT_FIN.

   CLEAR:WA_FIN.


 ENDLOOP.

 loop at it_fin into wa_fin.
 write:/2 wa_fin-matnr ,
       20 wa_fin-mtart,
       30 wa_fin-werks,
       40 wa_fin-lgort.

 ENDLOOP.