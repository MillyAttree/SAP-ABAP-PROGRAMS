*&---------------------------------------------------------------------*
*& Report  Y37_SHIPPING_REPORT
*&
*&---------------------------------------------------------------------*
*&
*&
*&---------------------------------------------------------------------*

REPORT  Y37_SHIPPING_REPORT NO STANDARD PAGE HEADING LINE-COUNT 300(10) LINE-SIZE 300 MESSAGE-ID ZRV.

TABLES: VBAK, VBAP ,VBFA, LIKP, LIPS, VBRK, VBRP.

TYPES: BEGIN OF TY_VBAK,
      VBELN TYPE VBAK-VBELN,
      AUART TYPE VBAK-AUART,
      ERDAT TYPE VBAK-ERDAT,
      END OF TY_VBAK.

DATA: IT_VBAK TYPE STANDARD TABLE OF TY_VBAK,
      WA_VBAK TYPE TY_VBAK.

TYPES: BEGIN OF TY_VBAP,
       VBELN TYPE VBAP-VBELN,
       VSTEL TYPE VBAP-VSTEL,
       LGORT TYPE VBAP-LGORT,
       END OF TY_VBAP.

DATA: IT_VBAP TYPE STANDARD TABLE OF TY_VBAP,
      WA_VBAP TYPE TY_VBAP.

TYPES: BEGIN OF TY_LIPS,
       VBELN TYPE LIPS-VBELN,
       VGBEL TYPE LIPS-VGBEL,
       VFDAT TYPE LIPS-VFDAT,
       END OF TY_LIPS.

DATA: IT_LIPS TYPE STANDARD TABLE OF TY_LIPS,
      WA_LIPS TYPE TY_LIPS.

TYPES: BEGIN OF TY_VBRK,
       VBELN TYPE VBRK-VBELN,
       NETWR TYPE VBRK-NETWR,
       TKNUM TYPE VTTP-TKNUM,
       END OF TY_VBRK.

DATA: IT_VBRK TYPE STANDARD TABLE OF TY_VBRK,
      WA_VBRK TYPE TY_VBRK.

TYPES: BEGIN OF TY_FIN,
      VBELN TYPE VBAK-VBELN,
      AUART TYPE VBAK-AUART,
      ERDAT TYPE VBAK-ERDAT,
      VSTEL TYPE VBAP-VSTEL,
      LGORT TYPE VBAP-LGORT,
      VBELN1 TYPE LIPS-VBELN,
      VGBEL TYPE LIPS-VGBEL,
      VFDAT TYPE LIPS-VFDAT,
      VBELN2 TYPE VBRK-VBELN,
      NETWR TYPE VBRK-NETWR,
      TKNUM TYPE VTTP-TKNUM,
      END OF TY_FIN.

DATA: IT_FIN TYPE STANDARD TABLE OF TY_FIN,
      WA_FIN TYPE TY_FIN.

SELECTION-SCREEN BEGIN OF BLOCK B1 WITH FRAME TITLE TEXT-001.
SELECT-OPTIONS:  S_VKORG FOR VBAK-VKORG DEFAULT '1000',

            S_VTWEG FOR VBAK-VTWEG DEFAULT '10',

            S_SPART FOR VBAK-SPART ,

            S_ERDAT FOR VBAK-ERDAT .

SELECTION-SCREEN END OF BLOCK B1.



START-OF-SELECTION.

PERFORM GET_DATA.

PERFORM DISP.

PERFORM ALV.

END-OF-SELECTION.



FORM GET_DATA.

  SELECT VBELN AUART ERDAT  FROM VBAK INTO TABLE IT_VBAK WHERE VKORG IN S_VKORG
                                      AND VTWEG IN S_VTWEG AND SPART IN S_SPART AND ERDAT IN S_ERDAT.
  IF SY-SUBRC EQ 0.
    SORT  IT_VBAK BY VBELN.
  ENDIF.


  IF IT_VBAK IS NOT INITIAL.
    SELECT VBELN VSTEL
       LGORT FROM VBAP INTO TABLE IT_VBAP FOR ALL ENTRIES IN IT_VBAK
      WHERE VBELN = IT_VBAK-VBELN.
  ENDIF.

  IF IT_VBAP IS NOT INITIAL.
    SELECT VBELV
        POSNV
        VBELN
        POSNN
        VBTYP_N FROM VBFA INTO TABLE IT_VBFA FOR ALL ENTRIES IN IT_VBAP WHERE VBELV = IT_VBAP-VBELN .
*      AND VBTYP_N = 'J'.
  ENDIF.

  IF  IT_VBFA IS NOT INITIAL .
    SELECT VBELN  VGBEL
       VFDAT
       FROM LIPS INTO TABLE IT_LIPS FOR ALL ENTRIES IN IT_VBFA
                                                WHERE VBELN = IT_VBFA-VBELN.
    IF SY-SUBRC EQ 0.
      SORT  IT_LIPS BY VBELN.
    ENDIF.
  ENDIF.




  IF IT_LIPS IS NOT INITIAL .

    SELECT VBELN POSNR FKLMG NTGEW NETWR VGBEL FROM VBRP INTO TABLE IT_VBRP FOR ALL ENTRIES IN IT_LIPS
      WHERE VGBEL = IT_LIPS-VBELN.
  ENDIF.

  IF IT_VBRP IS NOT INITIAL.
    SELECT VBELN FKDAT FROM VBRK INTO TABLE IT_VBRK FOR ALL ENTRIES IN IT_VBRP
                                                    WHERE VBELN = IT_VBRP-VBELN.
    IF SY-SUBRC EQ 0.
      SORT  IT_VBRK BY VBELN.
    ENDIF.
  ENDIF.







  LOOP AT IT_VBFA INTO WA_VBFA.

    CLEAR WA_VBAP.
    READ TABLE IT_VBAP INTO WA_VBAP WITH KEY VBELN = WA_VBFA-VBELV
                                              POSNR = WA_VBFA-POSNV.
    IF SY-SUBRC EQ 0.
      WA_FIN-VBELN = WA_VBAP-VBELN.
      WA_FIN-POSNR = WA_VBAP-POSNR.
      WA_FIN-MATNR = WA_VBAP-MATNR.
      WA_FIN-NETPR = WA_VBAP-NETPR.
    ENDIF.

    CLEAR WA_VBAK.
    READ TABLE IT_VBAK INTO WA_VBAK WITH KEY VBELN = WA_VBAP-VBELN.
    IF SY-SUBRC EQ 0.
      WA_FIN-ERDAT = WA_VBAK-ERDAT.
    ENDIF.

    CLEAR WA_LIPS.
    READ TABLE IT_LIPS INTO WA_LIPS WITH KEY VBELN = WA_VBFA-VBELN
                                             POSNR = WA_VBFA-POSNN .
    IF SY-SUBRC EQ 0.
      WA_FIN-VBELN1 = WA_LIPS-VBELN.
      WA_FIN-POSNR1 = WA_LIPS-POSNR.
      WA_FIN-LFIMG = WA_LIPS-LFIMG.
      WA_FIN-NETPR1 = WA_LIPS-NETPR.

    ENDIF.


    CLEAR: WA_LIKP.
    READ TABLE IT_LIKP INTO WA_LIKP WITH KEY VBELN = WA_LIPS-VBELN.

    IF SY-SUBRC EQ 0.
      WA_FIN-LFDAT = WA_LIKP-LFDAT.
    ENDIF.


    CLEAR WA_VBRP.
    READ TABLE IT_VBRP INTO WA_VBRP WITH KEY VGBEL = WA_LIPS-VBELN.
*                                             POSNR = WA_VBFA-POSNN .
    IF SY-SUBRC EQ 0.
      WA_FIN-VBELN2 = WA_VBRP-VBELN.
      WA_FIN-POSNR2 = WA_VBRP-POSNR.
      WA_FIN-FKLMG = WA_VBRP-FKLMG.
      WA_FIN-NTGEW = WA_VBRP-NTGEW.
      WA_FIN-NETWR = WA_VBRP-NETWR.

    ENDIF.


    CLEAR: WA_VBRK.
    READ TABLE IT_VBRK INTO WA_VBRK WITH KEY VBELN = WA_VBRP-VBELN.

    IF SY-SUBRC EQ 0.
      WA_FIN-FKDAT = WA_VBRK-FKDAT.
    ENDIF.


    APPEND WA_FIN TO IT_FIN.
    CLEAR WA_FIN.
  ENDLOOP.




ENDFORM.


FORM DISP.

   CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'VBELN'.
  WA_FCAT-SELTEXT_L = 'SALES NO.'.
  APPEND WA_FCAT TO IT_FCAT.


  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'ERDAT'.
  WA_FCAT-SELTEXT_L = 'CREATED ON'.
  APPEND WA_FCAT TO IT_FCAT.


  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'NETPR'.
  WA_FCAT-SELTEXT_L = 'NET PRICE'.
  WA_FCAT-JUST = 'L'.
  APPEND WA_FCAT TO IT_FCAT.


  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'POSNR'.
  WA_FCAT-SELTEXT_L = 'SALES ITEM'.
  WA_FCAT-JUST = 'L'.
  APPEND WA_FCAT TO IT_FCAT.

  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'MATNR'.
  WA_FCAT-SELTEXT_L = 'MATERIAL NO.'.
  APPEND WA_FCAT TO IT_FCAT.


  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'VBELN1'.
  WA_FCAT-SELTEXT_L = 'DELIVERY NO.'.
  APPEND WA_FCAT TO IT_FCAT.


  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'LFDAT'.
  WA_FCAT-SELTEXT_L = 'DELIVERY DATE'.
*  WA_FCAT-JUST = 'L'.
  APPEND WA_FCAT TO IT_FCAT.


  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'NETPR1'.
  WA_FCAT-SELTEXT_L = 'NET PRICE'.
  WA_FCAT-JUST = 'L'.
  APPEND WA_FCAT TO IT_FCAT.



  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'LFIMG'.
  WA_FCAT-SELTEXT_L = 'QVANTITY'.
*  WA_FCAT-JUST = 'L'.
  APPEND WA_FCAT TO IT_FCAT.

  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'POSNR1'.
  WA_FCAT-SELTEXT_L = 'DELIVERY ITEM'.
  WA_FCAT-JUST = 'L'.
  APPEND WA_FCAT TO IT_FCAT.

  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'VBELN2'.
  WA_FCAT-SELTEXT_L = 'BILL NO.'.
  APPEND WA_FCAT TO IT_FCAT.


  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'FKDAT'.
  WA_FCAT-SELTEXT_L = 'BILLING DATE'.
*  WA_FCAT-JUST = 'L'.
  APPEND WA_FCAT TO IT_FCAT.


  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'NETWR'.
  WA_FCAT-SELTEXT_L = 'BILLING AMOUNT'.
  WA_FCAT-JUST = 'L'.
  APPEND WA_FCAT TO IT_FCAT.


  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'NTGEW'.
  WA_FCAT-SELTEXT_L = 'NET WEIGHT'.
*  WA_FCAT-JUST = 'L'.
  APPEND WA_FCAT TO IT_FCAT.

  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'FKLMG'.
  WA_FCAT-SELTEXT_L = 'QVANTITY'.
*  WA_FCAT-JUST = 'L'.
  APPEND WA_FCAT TO IT_FCAT.

  CLEAR WA_FCAT.
  WA_FCAT-FIELDNAME = 'POSNR2'.
  WA_FCAT-SELTEXT_L = 'BILLING ITEM'.
  WA_FCAT-JUST = 'L'.
  APPEND WA_FCAT TO IT_FCAT.


ENDFORM.